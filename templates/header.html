{# ‚ïê‚ïê‚ïê –û–±—â–∏–π —Ö–µ–¥–µ—Ä BubbleManga ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê #}
<style>
/* ‚îÄ‚îÄ Global header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.g-header {
  position: sticky; top: 0; z-index: 200;
  background: rgba(9,9,11,.92);
  backdrop-filter: blur(20px) saturate(1.5);
  -webkit-backdrop-filter: blur(20px) saturate(1.5);
  border-bottom: 1px solid rgba(255,255,255,.07);
}
.g-inner {
  max-width: 1400px; margin: 0 auto;
  display: flex; align-items: center; gap: 12px;

  height: 160px; padding: 0 20px;
}

/* Logo */
.g-logo {
  display: flex; align-items: center;
  text-decoration: none; flex-shrink: 0;
}
.g-logo-img-desktop {
  height: 150px; width: auto; display: block; object-fit: contain;
}
.g-logo-img-mobile {
  height: 90px; width: auto; display: none; object-fit: contain;
}

/* Nav links */
.g-nav {
  display: flex; align-items: center; gap: 2px;
}
.g-nav-a {
  padding: 7px 12px; border-radius: 8px;
  color: rgba(244,244,245,.65); text-decoration: none;
  font-size: 14px; font-weight: 500; transition: all .18s;
  white-space: nowrap;
}
.g-nav-a:hover { background: rgba(255,255,255,.06); color: #f4f4f5; }
.g-nav-a.active { background: rgba(102,126,234,.15); color: #818cf8; }

/* Search form */
.g-search-form {
  flex: 1; display: flex; align-items: center;
  background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.09);
  border-radius: 10px; overflow: hidden; transition: border-color .2s;
  max-width: 340px;
}
.g-search-form:focus-within { border-color: rgba(102,126,234,.5); background: rgba(255,255,255,.07); }
.g-search-input {
  flex: 1; background: none; border: none; outline: none;
  color: #f4f4f5; font-size: 13px; font-family: inherit;
  padding: 0 12px; height: 36px;
}
.g-search-input::placeholder { color: rgba(244,244,245,.35); }
.g-search-submit {
  width: 36px; height: 36px; flex-shrink: 0;
  background: none; border: none; cursor: pointer;
  color: rgba(244,244,245,.45); display: flex;
  align-items: center; justify-content: center;
  transition: color .18s;
}
.g-search-submit:hover { color: #818cf8; }

/* Right actions */
.g-actions { display: flex; align-items: center; gap: 6px; margin-left: auto; }

/* User menu */
.g-user { position: relative; }
.g-user-trigger {
  display: flex; align-items: center; gap: 10px;
  padding: 6px 14px 6px 6px; border-radius: 32px;
  background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.09);
  cursor: pointer; transition: all .18s; color: #f4f4f5;
  font-family: inherit; font-size: 16px; font-weight: 600;
}
.g-user-trigger:hover { background: rgba(255,255,255,.1); border-color: rgba(255,255,255,.18); }
.g-ava {
  width: 48px; height: 48px; border-radius: 50%; overflow: hidden; flex-shrink: 0;
  background: linear-gradient(135deg,#667eea,#764ba2);
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; font-weight: 700; color: #fff;
}
.g-ava img { width: 100%; height: 100%; object-fit: cover; display: block; }
.g-uname { max-width: 160px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.g-caret { font-size: 10px; color: rgba(244,244,245,.4); transition: transform .2s; line-height: 1; }
.g-user.open .g-caret { transform: rotate(180deg); }

/* Dropdown */
.g-dropdown {
  position: absolute; top: calc(100% + 8px); right: 0; min-width: 180px;
  background: #18181b; border: 1px solid rgba(255,255,255,.1);
  border-radius: 14px; padding: 6px;
  box-shadow: 0 16px 48px rgba(0,0,0,.6);
  opacity: 0; visibility: hidden; transform: translateY(-6px);
  transition: all .18s; z-index: 300;
}
.g-user.open .g-dropdown { opacity: 1; visibility: visible; transform: translateY(0); }
.g-dd-a {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 12px; border-radius: 9px; color: rgba(244,244,245,.85);
  text-decoration: none; font-size: 13px; font-weight: 500; transition: all .15s;
}
.g-dd-a:hover { background: rgba(255,255,255,.07); color: #f4f4f5; }
.g-dd-sep { height: 1px; background: rgba(255,255,255,.07); margin: 4px 0; }
.g-dd-logout { color: rgba(239,68,68,.8); }
.g-dd-logout:hover { background: rgba(239,68,68,.1); color: #ef4444; }

/* Login button */
.g-login {
  padding: 7px 18px; border-radius: 20px; text-decoration: none;
  background: linear-gradient(135deg,#667eea,#764ba2);
  color: #fff; font-size: 13px; font-weight: 700;
  transition: opacity .18s; white-space: nowrap; flex-shrink: 0;
}
.g-login:hover { opacity: .85; }

/* Burger */
.g-burger {
  display: none; flex-direction: column; justify-content: center; gap: 5px;
  width: 36px; height: 36px; border-radius: 9px;
  background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.09);
  cursor: pointer; padding: 8px; transition: background .18s; flex-shrink: 0;
}
.g-burger span {
  display: block; height: 2px; border-radius: 2px;
  background: rgba(244,244,245,.7); transition: all .25s;
}
.g-burger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
.g-burger.open span:nth-child(2) { opacity: 0; }
.g-burger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

/* Mobile nav */
.g-mob-nav {
  display: none; flex-direction: column;
  border-top: 1px solid rgba(255,255,255,.07);
  padding: 8px 12px 14px; gap: 2px;
  background: rgba(9,9,11,.96);
}
.g-mob-nav.open { display: flex; }
.g-mob-a {
  padding: 10px 14px; border-radius: 10px;
  color: rgba(244,244,245,.8); text-decoration: none;
  font-size: 14px; font-weight: 500; transition: all .15s; display: block;
}
.g-mob-a:hover { background: rgba(255,255,255,.06); color: #f4f4f5; }
.g-mob-sep { height: 1px; background: rgba(255,255,255,.07); margin: 6px 0; }
.g-mob-logout { color: rgba(239,68,68,.75); }
.g-mob-logout:hover { background: rgba(239,68,68,.08); color: #ef4444; }
.g-mob-search {
  display: flex; align-items: center; margin: 4px 0 8px;
  background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.09);
  border-radius: 10px; overflow: hidden;
}
.g-mob-search input {
  flex: 1; background: none; border: none; outline: none;
  color: #f4f4f5; font-size: 14px; font-family: inherit; padding: 10px 12px;
}
.g-mob-search input::placeholder { color: rgba(244,244,245,.35); }
.g-mob-search button {
  width: 40px; height: 40px; background: none; border: none; cursor: pointer;
  color: rgba(244,244,245,.5); display: flex; align-items: center; justify-content: center;
}

/* Responsive */
@media (max-width: 900px) {
  .g-search-form { max-width: 200px; }
}
@media (max-width: 700px) {
  .g-inner { height: 100px; }
  .g-nav { display: none; }
  .g-burger { display: flex; }
  .g-search-form { display: none; }
  .g-uname { display: none; }

  .g-user-trigger { padding: 5px; }
  .g-logo-img-desktop { display: none; }
  .g-logo-img-mobile  { display: block; }

}
@media (max-width: 400px) {
  .g-inner { padding: 0 12px; gap: 8px; }
}
</style>

<header class="g-header" id="gHeader">
  <div class="g-inner">

    <a href="/" class="g-logo">
      <img src="/static/logo_desktop.png" class="g-logo-img-desktop" alt="BubbleManga">
      <img src="/static/logo_mobile.png"  class="g-logo-img-mobile"  alt="BubbleManga">
    </a>

    <nav class="g-nav">
      <a href="/" class="g-nav-a{% if g_active == 'home' %} active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="/top" class="g-nav-a{% if g_active == 'top' %} active{% endif %}">–¢–æ–ø</a>
      <a href="/collections/top" class="g-nav-a{% if g_active == 'collections_top' %} active{% endif %}">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</a>
      <a href="/shop" class="g-nav-a{% if g_active == 'shop' %} active{% endif %}">–ú–∞–≥–∞–∑–∏–Ω</a>
    </nav>

    <form class="g-search-form" action="/search" method="GET" autocomplete="off">
      <input class="g-search-input" type="text" name="q"
             placeholder="–ü–æ–∏—Å–∫ –º–∞–Ω–≥–∏..."
             value="{{ request.args.get('q', '') }}">
      <button type="submit" class="g-search-submit" aria-label="–ù–∞–π—Ç–∏">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
      </button>
    </form>

    <div class="g-actions">
      {% if session.user_id %}
      <div class="g-user" id="gUser">
        <button class="g-user-trigger" onclick="gToggleUser(event)" type="button">
          <div class="g-ava">
            {% if g_user and g_user.avatar_url %}
              <img src="{{ g_user.avatar_url }}" alt="">
            {% else %}
              {{ ((g_user.display_name if g_user else session.username) or '?')[0]|upper }}
            {% endif %}
          </div>
          <span class="g-uname">{{ g_user.display_name if g_user else session.username }}</span>
          <span class="g-caret">‚ñæ</span>
        </button>
        <div class="g-dropdown" id="gDropdown">
          <a href="/profile/me" class="g-dd-a">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
          <div class="g-dd-sep"></div>
          <a href="/logout" class="g-dd-a g-dd-logout">–í—ã–π—Ç–∏</a>
        </div>
      </div>
      {% else %}
      <a href="https://t.me/hookah_p_bot" target="_blank" class="g-login">–í–æ–π—Ç–∏</a>
      {% endif %}

      <button class="g-burger" id="gBurger" onclick="gToggleMob()" type="button" aria-label="–ú–µ–Ω—é">
        <span></span><span></span><span></span>
      </button>
    </div>
  </div>

  <div class="g-mob-nav" id="gMobNav">
    <form class="g-mob-search" action="/search" method="GET" autocomplete="off">
      <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –º–∞–Ω–≥–∏..."
             value="{{ request.args.get('q', '') }}">
      <button type="submit" aria-label="–ù–∞–π—Ç–∏">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
      </button>
    </form>
    <a href="/" class="g-mob-a">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="/top" class="g-mob-a">–¢–æ–ø</a>
    <a href="/collections/top" class="g-mob-a">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</a>
    <a href="/shop" class="g-mob-a">–ú–∞–≥–∞–∑–∏–Ω</a>
    {% if session.user_id %}
    <div class="g-mob-sep"></div>
    <a href="/profile/me" class="g-mob-a">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
    <a href="/logout" class="g-mob-a g-mob-logout">üö™ –í—ã–π—Ç–∏</a>
    {% else %}
    <div class="g-mob-sep"></div>
    <a href="https://t.me/hookah_p_bot" target="_blank" class="g-mob-a">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</a>
    {% endif %}
  </div>
</header>

<script>
(function() {
  function gToggleUser(e) {
    e.stopPropagation();
    var u = document.getElementById('gUser');
    if (u) u.classList.toggle('open');
  }
  function gToggleMob() {
    var m = document.getElementById('gMobNav');
    var b = document.getElementById('gBurger');
    if (m) m.classList.toggle('open');
    if (b) b.classList.toggle('open');
  }
  document.addEventListener('click', function(e) {
    if (!e.target.closest('#gUser')) {
      var u = document.getElementById('gUser');
      if (u) u.classList.remove('open');
    }
    if (!e.target.closest('#gBurger') && !e.target.closest('#gMobNav')) {
      var m = document.getElementById('gMobNav');
      var b = document.getElementById('gBurger');
      if (m) m.classList.remove('open');
      if (b) b.classList.remove('open');
    }
  });
  window.gToggleUser = gToggleUser;
  window.gToggleMob = gToggleMob;
})();
</script>
