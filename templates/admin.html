<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ â€” BubbleManga</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --primary:#667eea;--primary2:#764ba2;--accent:#ec4899;
  --green:#22c55e;--red:#ef4444;--yellow:#f59e0b;--blue:#3b82f6;
  --bg:#09090b;--bg2:#111113;--bg3:#18181b;--bg4:#1f1f23;
  --glass:rgba(255,255,255,.04);--glass2:rgba(255,255,255,.07);
  --border:rgba(255,255,255,.08);--border2:rgba(255,255,255,.14);
  --text:#f4f4f5;--text2:#a1a1aa;--text3:#71717a;
  --radius:14px;--shadow:0 8px 32px rgba(0,0,0,.5);
}
html{scroll-behavior:smooth}
body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.layout{display:flex;min-height:100vh}
.sidebar{
  width:240px;flex-shrink:0;
  background:var(--bg2);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  position:fixed;left:0;top:0;bottom:0;z-index:50;
  overflow-y:auto;
}
.sidebar-logo{
  padding:24px 20px 20px;
  font-weight:800;font-size:19px;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  border-bottom:1px solid var(--border);
}
.sidebar-logo span{display:block;font-size:11px;font-weight:500;color:var(--text3);-webkit-text-fill-color:var(--text3);margin-top:2px;letter-spacing:.5px}
.sidebar-nav{flex:1;padding:12px 8px}
.nav-item{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;border-radius:10px;
  cursor:pointer;transition:all .2s;
  font-size:14px;font-weight:500;color:var(--text2);
  border:none;background:none;width:100%;text-align:left;
  margin-bottom:2px;
}
.nav-item:hover{background:var(--glass2);color:var(--text)}
.nav-item.active{background:linear-gradient(135deg,rgba(102,126,234,.2),rgba(118,75,162,.15));color:var(--primary);border:1px solid rgba(102,126,234,.25)}
.nav-item .icon{font-size:17px;width:20px;text-align:center;flex-shrink:0}
.nav-item .badge{margin-left:auto;background:var(--primary);color:#fff;font-size:10px;font-weight:700;padding:1px 6px;border-radius:20px}
.sidebar-footer{padding:16px;border-top:1px solid var(--border)}
.sidebar-footer a{font-size:12px;color:var(--text3);text-decoration:none;transition:color .2s}
.sidebar-footer a:hover{color:var(--text2)}

/* â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main{margin-left:240px;flex:1;padding:28px 32px;max-width:1400px}
.page-header{margin-bottom:28px}
.page-title{font-size:24px;font-weight:700}
.page-subtitle{color:var(--text2);font-size:13px;margin-top:4px}

/* â”€â”€â”€ CARDS & GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;margin-bottom:28px}
.stat-card{
  background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);
  padding:20px;position:relative;overflow:hidden;transition:border-color .2s;
}
.stat-card:hover{border-color:var(--border2)}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--c,var(--primary))}
.stat-card .label{font-size:12px;color:var(--text2);font-weight:500;text-transform:uppercase;letter-spacing:.5px}
.stat-card .value{font-size:28px;font-weight:700;margin:6px 0 2px}
.stat-card .sub{font-size:12px;color:var(--text3)}
.stat-card .icon-bg{position:absolute;right:12px;top:50%;transform:translateY(-50%);font-size:36px;opacity:.12}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:28px}

/* â”€â”€â”€ PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel{background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:20px}
.panel-head{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border);background:var(--bg4)}
.panel-title{font-size:15px;font-weight:600}
.panel-body{padding:20px}

/* â”€â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tbl-wrap{overflow-x:auto;border-radius:var(--radius);border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:var(--bg4);color:var(--text2);font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.5px;padding:10px 14px;text-align:left;white-space:nowrap}
td{padding:11px 14px;border-top:1px solid var(--border);vertical-align:middle;white-space:nowrap}
tr:hover td{background:var(--glass)}
.user-cell{display:flex;align-items:center;gap:10px}
.user-ava{width:32px;height:32px;border-radius:50%;object-fit:cover;background:var(--bg4);flex-shrink:0;font-size:14px;display:flex;align-items:center;justify-content:center;color:var(--text2)}
.user-ava img{width:100%;height:100%;border-radius:50%;object-fit:cover}
.user-name{font-weight:500;max-width:140px;overflow:hidden;text-overflow:ellipsis}
.user-username{font-size:11px;color:var(--text3)}

/* â”€â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600}
.badge-green{background:rgba(34,197,94,.15);color:var(--green)}
.badge-red{background:rgba(239,68,68,.15);color:var(--red)}
.badge-yellow{background:rgba(245,158,11,.15);color:var(--yellow)}
.badge-blue{background:rgba(59,130,246,.15);color:var(--blue)}
.badge-purple{background:rgba(102,126,234,.15);color:var(--primary)}

/* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all .2s;font-family:inherit}
.btn-sm{padding:4px 10px;font-size:12px;border-radius:6px}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary2)}
.btn-danger{background:rgba(239,68,68,.15);color:var(--red);border:1px solid rgba(239,68,68,.25)}
.btn-danger:hover{background:rgba(239,68,68,.25)}
.btn-success{background:rgba(34,197,94,.15);color:var(--green);border:1px solid rgba(34,197,94,.25)}
.btn-success:hover{background:rgba(34,197,94,.25)}
.btn-ghost{background:var(--glass2);color:var(--text2);border:1px solid var(--border)}
.btn-ghost:hover{color:var(--text);border-color:var(--border2)}
.btn-icon{padding:6px;border-radius:6px;background:none;border:none;cursor:pointer;color:var(--text2);font-size:15px;transition:all .2s}
.btn-icon:hover{background:var(--glass2);color:var(--text)}

/* â”€â”€â”€ INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.input{
  background:var(--bg4);border:1px solid var(--border);border-radius:8px;
  color:var(--text);font-size:13px;font-family:inherit;padding:8px 12px;
  transition:border-color .2s;outline:none;width:100%;
}
.input:focus{border-color:rgba(102,126,234,.6)}
.input-sm{padding:5px 10px;font-size:12px;border-radius:6px}
.select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23a1a1aa' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;cursor:pointer}
.search-bar{display:flex;gap:10px;margin-bottom:16px}
.search-bar .input{max-width:320px}

/* â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section{display:none}
.section.active{display:block}

/* â”€â”€â”€ PAGINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pagination{display:flex;align-items:center;gap:8px;padding-top:12px;justify-content:flex-end}
.pagination .btn{min-width:36px;justify-content:center}
.page-info{font-size:12px;color:var(--text2);padding:0 8px}

/* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .2s;backdrop-filter:blur(4px)}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--bg3);border:1px solid var(--border2);border-radius:18px;width:100%;max-width:520px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow)}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 0}
.modal-title{font-size:17px;font-weight:700}
.modal-body{padding:20px 24px 24px;display:flex;flex-direction:column;gap:14px}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-label{font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.4px}

/* â”€â”€â”€ CHART BARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bar-chart{display:flex;gap:4px;align-items:flex-end;height:60px}
.bar-chart .bar{flex:1;background:var(--primary);border-radius:3px 3px 0 0;opacity:.7;min-height:4px;transition:opacity .2s;position:relative}
.bar-chart .bar:hover{opacity:1}
.bar-chart .bar::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 4px);left:50%;transform:translateX(-50%);background:var(--bg4);border:1px solid var(--border2);border-radius:6px;padding:3px 7px;font-size:11px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .2s}
.bar-chart .bar:hover::after{opacity:1}

/* â”€â”€â”€ FILE DROP ZONE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.drop-zone{
  border:2px dashed var(--border2);border-radius:12px;
  padding:24px 16px;text-align:center;cursor:pointer;
  transition:all .2s;background:var(--bg4);position:relative;
}
.drop-zone:hover,.drop-zone.over{border-color:var(--primary);background:rgba(102,126,234,.06)}
.drop-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.drop-zone .dz-icon{font-size:28px;margin-bottom:6px}
.drop-zone .dz-text{font-size:12px;color:var(--text2)}
.drop-zone .dz-hint{font-size:11px;color:var(--text3);margin-top:3px}
.preview-box{
  border:1px solid var(--border2);border-radius:10px;overflow:hidden;
  background:var(--bg);position:relative;
  display:flex;align-items:center;justify-content:center;
}
.preview-box img{width:100%;height:100%;object-fit:cover;display:block}
.preview-box .rm-btn{
  position:absolute;top:6px;right:6px;background:rgba(0,0,0,.65);
  border:none;color:#fff;font-size:14px;border-radius:50%;
  width:24px;height:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  line-height:1;
}
.preview-avatar{width:88px;height:88px;border-radius:50%;border:3px solid rgba(102,126,234,.5)}
.preview-avatar img{border-radius:50%}
.preview-bg{width:100%;height:80px}
.upload-progress{height:3px;background:var(--border);border-radius:2px;overflow:hidden;margin-top:8px;display:none}
.upload-progress-bar{height:100%;background:var(--primary);width:0%;transition:width .3s}

/* â”€â”€â”€ MISC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.text-green{color:var(--green)}.text-red{color:var(--red)}.text-yellow{color:var(--yellow)}.text-blue{color:var(--blue)}.text-muted{color:var(--text2)}
.gap-8{gap:8px}.flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}.wrap{flex-wrap:wrap}
.mt-4{margin-top:4px}.mt-8{margin-top:8px}.mt-16{margin-top:16px}.mb-4{margin-bottom:4px}.mb-8{margin-bottom:8px}.mb-16{margin-bottom:16px}
.empty{text-align:center;padding:40px 20px;color:var(--text3);font-size:13px}
.spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--border2);border-top-color:var(--primary);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-state{display:flex;justify-content:center;padding:40px}
.truncate{max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block}
.comment-text{max-width:360px;white-space:normal;line-height:1.4;font-size:12px;color:var(--text2)}
.mono{font-family:monospace;font-size:12px}

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast-container{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{background:var(--bg4);border:1px solid var(--border2);border-radius:10px;padding:10px 16px;font-size:13px;font-weight:500;min-width:200px;box-shadow:var(--shadow);animation:slideUp .3s ease;pointer-events:all}
.toast.success{border-color:rgba(34,197,94,.4);color:var(--green)}
.toast.error{border-color:rgba(239,68,68,.4);color:var(--red)}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}

@media(max-width:900px){
  .sidebar{width:60px}
  .sidebar-logo span,.nav-item span.label,.sidebar-footer{display:none}
  .nav-item{justify-content:center;padding:12px 0}
  .nav-item .icon{margin:0}
  .main{margin-left:60px;padding:20px 16px}
  .grid2,.grid3{grid-template-columns:1fr}
  .cards-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<div class="layout">

<!-- â•â•â• SIDEBAR â•â•â• -->
<nav class="sidebar">
  <div class="sidebar-logo">
    âš¡ BubbleManga
    <span>ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°</span>
  </div>
  <div class="sidebar-nav">
    <button class="nav-item active" onclick="showSection('stats')" data-section="stats">
      <span class="icon">ğŸ“Š</span><span class="label">Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</span>
    </button>
    <button class="nav-item" onclick="showSection('users')" data-section="users">
      <span class="icon">ğŸ‘¥</span><span class="label">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</span>
    </button>
    <button class="nav-item" onclick="showSection('comments')" data-section="comments">
      <span class="icon">ğŸ’¬</span><span class="label">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</span>
    </button>
    <button class="nav-item" onclick="showSection('manga')" data-section="manga">
      <span class="icon">ğŸ“š</span><span class="label">ĞœĞ°Ğ½Ğ³Ğ° Ğ² Ğ‘Ğ”</span>
    </button>
    <button class="nav-item" onclick="showSection('shop')" data-section="shop">
      <span class="icon">ğŸ›’</span><span class="label">ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</span>
    </button>
    <button class="nav-item" onclick="showSection('xplog')" data-section="xplog">
      <span class="icon">ğŸ“œ</span><span class="label">XP Ğ›Ğ¾Ğ³</span>
    </button>
    <button class="nav-item" onclick="showSection('achievements')" data-section="achievements">
      <span class="icon">ğŸ†</span><span class="label">Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ</span>
    </button>
    <button class="nav-item" onclick="showSection('quests')" data-section="quests">
      <span class="icon">ğŸ“‹</span><span class="label">Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ</span>
    </button>
  </div>
  <div class="sidebar-footer">
    <a href="/">â† ĞĞ° ÑĞ°Ğ¹Ñ‚</a>
  </div>
</nav>

<!-- â•â•â• MAIN â•â•â• -->
<main class="main">

<!-- â”€â”€ STATS â”€â”€ -->
<div id="section-stats" class="section active">
  <div class="page-header">
    <div class="page-title">Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</div>
    <div class="page-subtitle">ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹</div>
  </div>

  <div class="cards-grid" id="stat-cards">
    <div class="stat-card" style="--c:var(--primary)">
      <div class="label">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</div>
      <div class="value" id="s-users">â€”</div>
      <div class="sub" id="s-users-sub">...</div>
      <div class="icon-bg">ğŸ‘¥</div>
    </div>
    <div class="stat-card" style="--c:var(--green)">
      <div class="label">ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼</div>
      <div class="value" id="s-premium">â€”</div>
      <div class="sub">Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ…</div>
      <div class="icon-bg">â­</div>
    </div>
    <div class="stat-card" style="--c:var(--red)">
      <div class="label">Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹</div>
      <div class="value" id="s-banned">â€”</div>
      <div class="sub">Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</div>
      <div class="icon-bg">ğŸ”¨</div>
    </div>
    <div class="stat-card" style="--c:var(--yellow)">
      <div class="label">ĞĞ¾Ğ²Ñ‹Ğµ (7Ğ´)</div>
      <div class="value" id="s-new-week">â€”</div>
      <div class="sub">Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¹</div>
      <div class="icon-bg">ğŸ†•</div>
    </div>
    <div class="stat-card" style="--c:var(--blue)">
      <div class="label">ĞœĞ°Ğ½Ğ³Ğ° Ğ² Ğ‘Ğ”</div>
      <div class="value" id="s-manga">â€”</div>
      <div class="sub">Ñ‚Ğ°Ğ¹Ñ‚Ğ»Ğ¾Ğ²</div>
      <div class="icon-bg">ğŸ“š</div>
    </div>
    <div class="stat-card" style="--c:var(--accent)">
      <div class="label">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</div>
      <div class="value" id="s-comments">â€”</div>
      <div class="sub">Ğ²ÑĞµĞ³Ğ¾</div>
      <div class="icon-bg">ğŸ’¬</div>
    </div>
    <div class="stat-card" style="--c:#8b5cf6">
      <div class="label">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</div>
      <div class="value" id="s-subs">â€”</div>
      <div class="sub">Ğ²ÑĞµĞ³Ğ¾</div>
      <div class="icon-bg">ğŸ””</div>
    </div>
    <div class="stat-card" style="--c:#06b6d4">
      <div class="label">Ğ“Ğ»Ğ°Ğ² Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾</div>
      <div class="value" id="s-read">â€”</div>
      <div class="sub">ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ½Ğ¾</div>
      <div class="icon-bg">ğŸ“–</div>
    </div>
  </div>

  <div class="grid2">
    <div class="panel">
      <div class="panel-head">
        <div class="panel-title">ğŸ† Ğ¢Ğ¾Ğ¿ Ğ¿Ğ¾ XP</div>
      </div>
      <div class="panel-body" style="padding:0">
        <table id="top-users-table">
          <thead><tr><th>#</th><th>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</th><th>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</th><th>XP</th><th>ĞœĞ¾Ğ½ĞµÑ‚</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="panel">
      <div class="panel-head">
        <div class="panel-title">ğŸ”¥ Ğ¢Ğ¾Ğ¿ Ğ¼Ğ°Ğ½Ğ³Ğ¸ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°Ğ¼</div>
      </div>
      <div class="panel-body" style="padding:0">
        <table id="top-manga-table">
          <thead><tr><th>#</th><th>ĞœĞ°Ğ½Ğ³Ğ°</th><th>ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ñ‹</th><th>ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-head">
      <div class="panel-title">ğŸ“ˆ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ (14 Ğ´Ğ½ĞµĞ¹)</div>
    </div>
    <div class="panel-body">
      <div id="reg-chart" class="bar-chart"></div>
    </div>
  </div>
</div>

<!-- â”€â”€ USERS â”€â”€ -->
<div id="section-users" class="section">
  <div class="page-header">
    <div class="page-title">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</div>
    <div class="page-subtitle" id="users-subtitle">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
  </div>

  <div class="search-bar">
    <input class="input" id="users-search" placeholder="ğŸ” ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸, ÑĞ·ĞµÑ€Ğ½ĞµĞ¹Ğ¼Ñƒ, ID..." oninput="debounce(loadUsers, 400)()">
    <button class="btn btn-primary" onclick="loadUsers()">ĞĞ°Ğ¹Ñ‚Ğ¸</button>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th><th>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</th><th>TG ID</th>
          <th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th><th>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</th><th>XP</th>
          <th>ĞœĞ¾Ğ½ĞµÑ‚ ğŸ«§</th><th>ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</th><th>ĞšĞ¾Ğ¼Ğ¼.</th>
          <th>Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th>
        </tr>
      </thead>
      <tbody id="users-tbody"></tbody>
    </table>
  </div>
  <div class="pagination" id="users-pagination"></div>
</div>

<!-- â”€â”€ COMMENTS â”€â”€ -->
<div id="section-comments" class="section">
  <div class="page-header">
    <div class="page-title">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</div>
    <div class="page-subtitle" id="comments-subtitle">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
  </div>

  <div class="search-bar">
    <input class="input" id="comments-search" placeholder="ğŸ” ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞºÑÑ‚Ñƒ, Ğ°Ğ²Ñ‚Ğ¾Ñ€Ñƒ, ÑĞ»Ğ°Ğ³Ñƒ Ğ¼Ğ°Ğ½Ğ³Ğ¸..." oninput="debounce(loadComments, 400)()">
    <button class="btn btn-primary" onclick="loadComments()">ĞĞ°Ğ¹Ñ‚Ğ¸</button>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th><th>ĞĞ²Ñ‚Ğ¾Ñ€</th><th>ĞœĞ°Ğ½Ğ³Ğ°</th><th>ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹</th><th>Ğ”Ğ°Ñ‚Ğ°</th><th></th>
        </tr>
      </thead>
      <tbody id="comments-tbody"></tbody>
    </table>
  </div>
  <div class="pagination" id="comments-pagination"></div>
</div>

<!-- â”€â”€ MANGA â”€â”€ -->
<div id="section-manga" class="section">
  <div class="page-header">
    <div class="page-title">ĞœĞ°Ğ½Ğ³Ğ° Ğ² Ğ‘Ğ”</div>
    <div class="page-subtitle" id="manga-subtitle">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
  </div>

  <div class="search-bar">
    <input class="input" id="manga-search" placeholder="ğŸ” ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ ÑĞ»Ğ°Ğ³Ñƒ..." oninput="debounce(loadManga, 400)()">
    <button class="btn btn-primary" onclick="loadManga()">ĞĞ°Ğ¹Ñ‚Ğ¸</button>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th>ĞĞ±Ğ»Ğ¾Ğ¶ĞºĞ°</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ¢Ğ¸Ğ¿</th><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th>
          <th>Ğ“Ğ»Ğ°Ğ²</th><th>ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ñ‹</th><th>ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</th><th>ĞšĞ¾Ğ¼Ğ¼.</th>
        </tr>
      </thead>
      <tbody id="manga-tbody"></tbody>
    </table>
  </div>
  <div class="pagination" id="manga-pagination"></div>
</div>

<!-- â”€â”€ SHOP â”€â”€ -->
<div id="section-shop" class="section">
  <div class="page-header" style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <div class="page-title">ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</div>
      <div class="page-subtitle">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ğ¼Ğ¸</div>
    </div>
    <button class="btn btn-primary" onclick="openShopModal()">+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€</button>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th>ID</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ¢Ğ¸Ğ¿</th><th>Ğ¦ĞµĞ½Ğ° ğŸ«§</th>
          <th>CSS Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ</th><th>ĞšÑƒĞ¿Ğ»ĞµĞ½Ğ¾</th><th>Ğ¤Ğ»Ğ°Ğ³Ğ¸</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th>
        </tr>
      </thead>
      <tbody id="shop-tbody"></tbody>
    </table>
  </div>
</div>

<!-- â”€â”€ XP LOG â”€â”€ -->
<div id="section-xplog" class="section">
  <div class="page-header">
    <div class="page-title">XP Ğ›Ğ¾Ğ³</div>
    <div class="page-subtitle" id="xplog-subtitle">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>ID</th><th>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</th><th>ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°</th><th>Ref ID</th><th>XP</th><th>Ğ”Ğ°Ñ‚Ğ°</th></tr>
      </thead>
      <tbody id="xplog-tbody"></tbody>
    </table>
  </div>
  <div class="pagination" id="xplog-pagination"></div>
</div>

<!-- â”€â”€ ACHIEVEMENTS â”€â”€ -->
<div id="section-achievements" class="section">
  <div class="page-header" style="display:flex;justify-content:space-between;align-items:flex-start">
    <div>
      <div class="page-title">Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ</div>
      <div class="page-subtitle">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ¼ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹</div>
    </div>
    <button class="btn btn-primary" onclick="openAchModal()">+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
  </div>
  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>ID</th><th>Ğ˜ĞºĞ¾Ğ½ĞºĞ°</th><th>ĞšĞ»ÑÑ‡</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ</th><th>Ğ¦ĞµĞ»ÑŒ</th><th>XP Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr>
      </thead>
      <tbody id="ach-tbody"></tbody>
    </table>
  </div>
</div>

<!-- â”€â”€ QUESTS â”€â”€ -->
<div id="section-quests" class="section">
  <div class="page-header" style="display:flex;justify-content:space-between;align-items:flex-start">
    <div>
      <div class="page-title">Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ</div>
      <div class="page-subtitle">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ²ĞµÑÑ‚Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½ÑĞ¼</div>
    </div>
    <button class="btn btn-primary" onclick="openQuestModal()">+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
  </div>
  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>ID</th><th>Ğ˜ĞºĞ¾Ğ½ĞºĞ°</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</th><th>Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ</th><th>Ğ¦ĞµĞ»ÑŒ</th><th>XP</th><th>ğŸ«§</th><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr>
      </thead>
      <tbody id="quests-tbody"></tbody>
    </table>
  </div>
</div>

</main>
</div>

<!-- â•â•â• USER MODAL â•â•â• -->
<div class="modal-overlay" id="user-modal" onclick="closeUserModal(event)">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="um-title">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</div>
      <button class="btn-icon" onclick="document.getElementById('user-modal').classList.remove('open')">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="um-info" class="panel" style="background:var(--bg4);border-color:var(--border)">
        <div class="panel-body" style="padding:14px;display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px" id="um-details"></div>
      </div>

      <div class="panel" style="background:var(--bg4);border-color:var(--border)">
        <div class="panel-head" style="padding:12px 16px"><div class="panel-title" style="font-size:13px">ğŸ’° ĞœĞ¾Ğ½ĞµÑ‚Ñ‹ & XP</div></div>
        <div class="panel-body" style="padding:12px 16px;display:flex;flex-direction:column;gap:10px">
          <div style="display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center">
            <input class="input input-sm" id="um-coins-val" type="number" placeholder="Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ¼Ğ¾Ğ½ĞµÑ‚">
            <select class="input input-sm select" id="um-coins-mode" style="width:auto">
              <option value="set">Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ</option>
              <option value="add">ĞĞ°Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ</option>
            </select>
            <button class="btn btn-sm btn-success" onclick="setCoins()">âœ“</button>
          </div>
          <div style="display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center">
            <input class="input input-sm" id="um-xp-val" type="number" placeholder="Ğ¡ÑƒĞ¼Ğ¼Ğ° XP">
            <select class="input input-sm select" id="um-xp-mode" style="width:auto">
              <option value="set">Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ</option>
              <option value="add">ĞĞ°Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ</option>
            </select>
            <button class="btn btn-sm btn-success" onclick="setXP()">âœ“</button>
          </div>
        </div>
      </div>

      <div class="panel" style="background:var(--bg4);border-color:var(--border)">
        <div class="panel-head" style="padding:12px 16px"><div class="panel-title" style="font-size:13px">â­ ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼</div></div>
        <div class="panel-body" style="padding:12px 16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <input class="input input-sm" id="um-premium-days" type="number" value="30" min="1" max="3650" style="width:90px" placeholder="Ğ”Ğ½ĞµĞ¹">
          <button class="btn btn-sm btn-success" onclick="setPremium(true)">Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ</button>
          <button class="btn btn-sm btn-danger" onclick="setPremium(false)">Ğ¡Ğ½ÑÑ‚ÑŒ</button>
        </div>
      </div>

      <div class="panel" style="background:var(--bg4);border-color:var(--border)">
        <div class="panel-head" style="padding:12px 16px;display:flex;justify-content:space-between;align-items:center">
          <div class="panel-title" style="font-size:13px">ğŸ”” ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ (<span id="um-subs-count">0</span>)</div>
          <div style="display:flex;gap:6px">
            <input class="input input-sm" id="um-sub-manga-id" placeholder="manga_id" style="width:160px">
            <button class="btn btn-sm btn-ghost" onclick="addSub()">+ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
          </div>
        </div>
        <div class="panel-body" style="padding:0;max-height:180px;overflow-y:auto">
          <table style="font-size:12px">
            <tbody id="um-subs-tbody"></tbody>
          </table>
        </div>
      </div>

      <div style="display:flex;gap:8px;padding-top:4px">
        <button class="btn btn-danger" id="um-ban-btn" onclick="toggleBan()" style="flex:1">ğŸ”¨ Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>
        <button class="btn btn-ghost" onclick="document.getElementById('user-modal').classList.remove('open')" style="flex:1">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SHOP ITEM MODAL â•â•â• -->
<div class="modal-overlay" id="shop-modal" onclick="closeShopModal(event)">
  <div class="modal" style="max-width:580px">
    <div class="modal-head">
      <div class="modal-title" id="sm-title">ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€</div>
      <button class="btn-icon" onclick="document.getElementById('shop-modal').classList.remove('open')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="sm-id">

      <!-- Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</label>
          <input class="input" id="sm-name" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°">
        </div>
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
          <input class="input" id="sm-description" placeholder="ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ">
        </div>
        <div class="form-group">
          <label class="form-label">Ğ¢Ğ¸Ğ¿</label>
          <select class="input select" id="sm-type" onchange="onShopTypeChange()">
            <option value="avatar">ğŸ–¼ ĞĞ²Ğ°Ñ‚Ğ°Ñ€ (avatar)</option>
            <option value="frame">ğŸ”² Ğ Ğ°Ğ¼ĞºĞ° (frame)</option>
            <option value="background">ğŸŒ… Ğ¤Ğ¾Ğ½ (background)</option>
            <option value="badge">ğŸ… Ğ—Ğ½Ğ°Ñ‡Ğ¾Ğº (badge)</option>
            <option value="avatar_slot">ğŸ“¤ Ğ¡Ğ»Ğ¾Ñ‚ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°</option>
            <option value="bg_slot">ğŸ“¤ Ğ¡Ğ»Ğ¾Ñ‚ Ñ„Ğ¾Ğ½Ğ°</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Ğ¦ĞµĞ½Ğ° ğŸ«§</label>
          <input class="input" id="sm-price" type="number" min="0" value="0">
        </div>
      </div>

      <!-- Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² avatar / background / badge / frame -->
      <div id="sm-file-section" class="form-group">
        <label class="form-label" id="sm-file-label">Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°</label>

        <!-- ĞŸÑ€ĞµĞ²ÑŒÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ -->
        <div id="sm-preview-wrap" style="display:none;margin-bottom:10px">
          <div id="sm-preview-box" class="preview-box" style="height:120px;width:120px">
            <img id="sm-preview-img" src="" alt="">
            <button class="rm-btn" onclick="clearShopImage()" title="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ">âœ•</button>
          </div>
        </div>

        <!-- Drag & Drop Ğ·Ğ¾Ğ½Ğ° -->
        <div class="drop-zone" id="sm-drop-zone">
          <input type="file" id="sm-file-input" accept="image/png,image/jpeg,image/webp,image/gif" onchange="onShopFileSelect(this)">
          <div class="dz-icon">ğŸ–¼</div>
          <div class="dz-text">ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°</div>
          <div class="dz-hint">PNG, JPG, WEBP, GIF â€” Ğ´Ğ¾ 5 ĞœĞ‘</div>
        </div>
        <div class="upload-progress" id="sm-progress">
          <div class="upload-progress-bar" id="sm-progress-bar"></div>
        </div>

        <!-- Ğ˜Ğ»Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ URL -->
        <div style="display:flex;align-items:center;gap:8px;margin-top:10px">
          <div style="flex:1;height:1px;background:var(--border)"></div>
          <span style="font-size:11px;color:var(--text3)">Ğ¸Ğ»Ğ¸ ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ URL</span>
          <div style="flex:1;height:1px;background:var(--border)"></div>
        </div>
        <input class="input" id="sm-preview-url" placeholder="https://example.com/image.jpg" style="margin-top:8px" oninput="onPreviewUrlInput()">
      </div>

      <!-- CSS â€” Ğ´Ğ»Ñ Ñ€Ğ°Ğ¼Ğ¾Ğº/Ñ„Ğ¾Ğ½Ğ¾Ğ²/Ğ·Ğ½Ğ°Ñ‡ĞºĞ¾Ğ² -->
      <div class="form-group" id="sm-css-section">
        <label class="form-label" id="sm-css-label">CSS Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ</label>
        <input class="input" id="sm-css" placeholder="border: 3px solid gold; box-shadow: ...">
        <div style="font-size:11px;color:var(--text3);margin-top:4px" id="sm-css-hint"></div>
      </div>

      <div style="display:flex;gap:20px;align-items:center">
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer">
          <input type="checkbox" id="sm-upload" style="width:16px;height:16px">
          Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼Ñ‹Ğ¹ ÑĞ»Ğ¾Ñ‚
        </label>
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer">
          <input type="checkbox" id="sm-animated" style="width:16px;height:16px">
          ĞĞ½Ğ¸Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹
        </label>
      </div>

      <div style="display:flex;gap:8px;padding-top:4px">
        <button class="btn btn-primary" onclick="saveShopItem()" style="flex:1" id="sm-save-btn">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
        <button class="btn btn-ghost" onclick="document.getElementById('shop-modal').classList.remove('open')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• ACHIEVEMENT MODAL â•â•â• -->
<div class="modal-overlay" id="ach-modal" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="modal" style="max-width:520px">
    <div class="modal-head">
      <div class="modal-title" id="ach-modal-title">ĞĞ¾Ğ²Ğ¾Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ</div>
      <button class="btn-icon" onclick="$('ach-modal').classList.remove('open')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="ach-id">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="form-group">
          <label class="form-label">ĞšĞ»ÑÑ‡ (ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹)</label>
          <input class="input" id="ach-key" placeholder="my_achievement">
        </div>
        <div class="form-group">
          <label class="form-label">Ğ˜ĞºĞ¾Ğ½ĞºĞ° (ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸)</label>
          <input class="input" id="ach-icon" placeholder="ğŸ†" style="font-size:20px">
        </div>
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</label>
          <input class="input" id="ach-name" placeholder="Ğ§Ğ¸Ñ‚Ğ°Ñ‚ĞµĞ»ÑŒ">
        </div>
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
          <input class="input" id="ach-description" placeholder="ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ 10 Ğ³Ğ»Ğ°Ğ²">
        </div>
        <div class="form-group">
          <label class="form-label">Ğ¢Ğ¸Ğ¿ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ</label>
          <select class="input select" id="ach-condition-type">
            <option value="chapters_read">ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ Ğ³Ğ»Ğ°Ğ²</option>
            <option value="subscriptions">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</option>
            <option value="level">Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</option>
            <option value="comments_posted">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ</label>
          <input class="input" id="ach-condition-value" type="number" min="1" value="1">
        </div>
        <div class="form-group">
          <label class="form-label">XP Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°</label>
          <input class="input" id="ach-xp-reward" type="number" min="0" value="0">
        </div>
        <div class="form-group">
          <label class="form-label">ĞšĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ° (URL Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ)</label>
          <input class="input" id="ach-icon-url" placeholder="https://... Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ" oninput="achPreviewUrl()">
        </div>
      </div>
      <div class="form-group" style="margin-top:4px">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="drop-zone" id="ach-drop-zone" style="padding:14px 20px">
            <input type="file" id="ach-file-input" accept="image/png,image/jpeg,image/webp,image/gif" onchange="uploadIconFile('ach',this)">
            <div class="dz-icon" style="font-size:20px">ğŸ–¼</div>
            <div class="dz-text" style="font-size:12px">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ</div>
          </div>
          <div id="ach-preview-wrap" style="display:none;flex-shrink:0">
            <div style="width:72px;height:72px;border-radius:10px;overflow:hidden;border:2px solid var(--border2);position:relative">
              <img id="ach-preview-img" src="" style="width:100%;height:100%;object-fit:cover">
              <button onclick="clearIconPreview('ach')" style="position:absolute;top:2px;right:2px;background:rgba(0,0,0,.6);border:none;color:#fff;cursor:pointer;border-radius:4px;font-size:11px;padding:1px 4px">âœ•</button>
            </div>
          </div>
        </div>
        <div class="upload-progress" id="ach-progress"><div class="upload-progress-bar" id="ach-progress-bar"></div></div>
      </div>
      <div style="display:flex;gap:8px;padding-top:4px">
        <button class="btn btn-primary" onclick="saveAchievement()" style="flex:1" id="ach-save-btn">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
        <button class="btn btn-ghost" onclick="$('ach-modal').classList.remove('open')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• QUEST MODAL â•â•â• -->
<div class="modal-overlay" id="quest-modal" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="modal" style="max-width:540px">
    <div class="modal-head">
      <div class="modal-title" id="quest-modal-title">ĞĞ¾Ğ²Ğ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ</div>
      <button class="btn-icon" onclick="$('quest-modal').classList.remove('open')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="quest-id">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</label>
          <input class="input" id="quest-title" placeholder="ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹">
        </div>
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
          <input class="input" id="quest-description" placeholder="ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ ÑĞ²Ğ¾Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹">
        </div>
        <div class="form-group">
          <label class="form-label">Ğ˜ĞºĞ¾Ğ½ĞºĞ° (ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸)</label>
          <input class="input" id="quest-icon" placeholder="ğŸ“‹" style="font-size:20px">
        </div>
        <div class="form-group">
          <label class="form-label">ĞœĞ¸Ğ½. ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ</label>
          <input class="input" id="quest-required-level" type="number" min="1" value="1">
        </div>
        <div class="form-group">
          <label class="form-label">Ğ¢Ğ¸Ğ¿ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ</label>
          <select class="input select" id="quest-condition-type">
            <option value="chapters_read">ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ Ğ³Ğ»Ğ°Ğ²</option>
            <option value="subscriptions">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</option>
            <option value="level">Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</option>
            <option value="comments_posted">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ</label>
          <input class="input" id="quest-condition-value" type="number" min="1" value="1">
        </div>
        <div class="form-group">
          <label class="form-label">XP Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°</label>
          <input class="input" id="quest-xp-reward" type="number" min="0" value="0">
        </div>
        <div class="form-group">
          <label class="form-label">ĞœĞ¾Ğ½ĞµÑ‚Ñ‹ ğŸ«§ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°</label>
          <input class="input" id="quest-coins-reward" type="number" min="0" value="0">
        </div>
        <div class="form-group" style="grid-column:span 2">
          <label class="form-label">ĞšĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ° (URL Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ)</label>
          <input class="input" id="quest-icon-url" placeholder="https://... Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ" oninput="questPreviewUrl()">
        </div>
      </div>
      <div class="form-group" style="margin-top:4px">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="drop-zone" id="quest-drop-zone" style="padding:14px 20px">
            <input type="file" id="quest-file-input" accept="image/png,image/jpeg,image/webp,image/gif" onchange="uploadIconFile('quest',this)">
            <div class="dz-icon" style="font-size:20px">ğŸ–¼</div>
            <div class="dz-text" style="font-size:12px">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ</div>
          </div>
          <div id="quest-preview-wrap" style="display:none;flex-shrink:0">
            <div style="width:72px;height:72px;border-radius:10px;overflow:hidden;border:2px solid var(--border2);position:relative">
              <img id="quest-preview-img" src="" style="width:100%;height:100%;object-fit:cover">
              <button onclick="clearIconPreview('quest')" style="position:absolute;top:2px;right:2px;background:rgba(0,0,0,.6);border:none;color:#fff;cursor:pointer;border-radius:4px;font-size:11px;padding:1px 4px">âœ•</button>
            </div>
          </div>
        </div>
        <div class="upload-progress" id="quest-progress"><div class="upload-progress-bar" id="quest-progress-bar"></div></div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:4px 0">
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer">
          <input type="checkbox" id="quest-is-active" checked style="width:16px;height:16px">
          ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾
        </label>
      </div>
      <div style="display:flex;gap:8px;padding-top:4px">
        <button class="btn btn-primary" onclick="saveQuest()" style="flex:1" id="quest-save-btn">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
        <button class="btn btn-ghost" onclick="$('quest-modal').classList.remove('open')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• TOAST CONTAINER â•â•â• -->
<div id="toast-container"></div>

<script>
// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $ = id => document.getElementById(id);

function toast(msg, type='success'){
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.textContent = msg;
  $('toast-container').appendChild(el);
  setTimeout(()=>el.remove(), 3000);
}

function fmtNum(n){ if(n==null)return'â€”'; n=Number(n); if(n>=1e6)return(n/1e6).toFixed(1)+'M'; if(n>=1e3)return(n/1e3).toFixed(1)+'K'; return n.toLocaleString('ru') }
function fmtDate(s){ if(!s)return'â€”'; const d=new Date(s); return d.toLocaleDateString('ru',{day:'2-digit',month:'2-digit',year:'2-digit'})+' '+d.toLocaleTimeString('ru',{hour:'2-digit',minute:'2-digit'}) }
function fmtDateShort(s){ if(!s)return''; const d=new Date(s); return d.toLocaleDateString('ru',{day:'2-digit',month:'2-digit',year:'2-digit'}) }
function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }
function userName(u){ return esc(u.custom_name || u.telegram_first_name || u.telegram_username || `#${u.id||u.user_id}`) }

const debounceTimers = {};
function debounce(fn, delay){
  return function(...args){
    clearTimeout(debounceTimers[fn]);
    debounceTimers[fn] = setTimeout(()=>fn(...args), delay);
  }
}

async function api(url, opts={}){
  const r = await fetch(url, {headers:{'Content-Type':'application/json'}, ...opts});
  return r.json();
}

// â”€â”€â”€ SECTION NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const sectionLoaded = {};
function showSection(name){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(b=>{
    b.classList.toggle('active', b.dataset.section===name);
  });
  $(`section-${name}`).classList.add('active');
  if(!sectionLoaded[name]){
    sectionLoaded[name]=true;
    if(name==='stats') loadStats();
    if(name==='users') loadUsers();
    if(name==='comments') loadComments();
    if(name==='manga') loadManga();
    if(name==='shop') loadShop();
    if(name==='xplog') loadXpLog();
    if(name==='achievements') loadAchievements();
    if(name==='quests') loadQuests();
  }
}

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadStats(){
  const d = await api('/api/admin/stats');
  $('s-users').textContent = fmtNum(d.users.total);
  $('s-users-sub').textContent = `Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ° Ğ½ĞµĞ´: ${d.users.new_week}`;
  $('s-premium').textContent = fmtNum(d.users.premium);
  $('s-banned').textContent = fmtNum(d.users.banned);
  $('s-new-week').textContent = fmtNum(d.users.new_week);
  $('s-manga').textContent = fmtNum(d.manga.total);
  $('s-comments').textContent = fmtNum(d.comments.total);
  $('s-subs').textContent = fmtNum(d.subscriptions.total);
  $('s-read').textContent = fmtNum(d.history.chapters_read);

  // Top users table
  const tb = $('top-users-table').querySelector('tbody');
  tb.innerHTML = d.top_users.map((u,i)=>`
    <tr>
      <td style="color:var(--text3)">#${i+1}</td>
      <td><span class="user-name" style="cursor:pointer;color:var(--primary)" onclick="openUserModal(${u.id})">${userName(u)}</span><br>
          <span style="font-size:11px;color:var(--text3)">@${esc(u.telegram_username||'â€”')}</span></td>
      <td><span class="badge badge-purple">Ğ£Ñ€. ${u.level}</span></td>
      <td><b>${fmtNum(u.xp)}</b></td>
      <td>${fmtNum(u.coins)} ğŸ«§</td>
    </tr>
  `).join('');

  // Top manga table
  const tm = $('top-manga-table').querySelector('tbody');
  tm.innerHTML = d.top_manga.map((m,i)=>`
    <tr>
      <td style="color:var(--text3)">#${i+1}</td>
      <td><a href="/manga/${esc(m.manga_slug)}" target="_blank" style="color:var(--primary);text-decoration:none" class="truncate">${esc(m.manga_title)}</a></td>
      <td>${fmtNum(m.views)}</td>
      <td>â€”</td>
    </tr>
  `).join('');

  // Bar chart
  if(d.reg_activity && d.reg_activity.length){
    const max = Math.max(...d.reg_activity.map(r=>r.cnt));
    $('reg-chart').innerHTML = d.reg_activity.map(r=>`
      <div class="bar" style="height:${Math.round((r.cnt/max)*56)+4}px" data-tip="${r.day}: ${r.cnt}"></div>
    `).join('');
  }
}

// â”€â”€â”€ USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let usersPage = 1;
async function loadUsers(page){
  if(page) usersPage = page;
  const q = $('users-search').value.trim();
  const d = await api(`/api/admin/users?page=${usersPage}&per_page=30&q=${encodeURIComponent(q)}`);
  $('users-subtitle').textContent = `Ğ’ÑĞµĞ³Ğ¾: ${d.total}`;

  $('users-tbody').innerHTML = d.users.map(u=>`
    <tr>
      <td style="color:var(--text3)">${u.id}</td>
      <td>
        <div class="user-cell">
          <div class="user-ava">${u.avatar_url ? `<img src="${esc(u.avatar_url)}" onerror="this.style.display='none'">` : 'ğŸ‘¤'}</div>
          <div>
            <div class="user-name" style="cursor:pointer;color:var(--primary)" onclick="openUserModal(${u.id})">${userName(u)}</div>
            <div class="user-username">@${esc(u.telegram_username||'â€”')}</div>
          </div>
        </div>
      </td>
      <td class="mono">${u.telegram_id}</td>
      <td>
        ${u.is_active ? '<span class="badge badge-green">ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½</span>' : '<span class="badge badge-red">Ğ—Ğ°Ğ±Ğ°Ğ½ĞµĞ½</span>'}
        ${u.is_premium ? '<span class="badge badge-yellow" title="Ğ´Ğ¾ '+esc(u.premium_expires_at||'')+'">â­</span>' : ''}
      </td>
      <td><span class="badge badge-purple">Ğ£Ñ€. ${u.level}</span></td>
      <td>${fmtNum(u.xp)}</td>
      <td>${fmtNum(u.coins)} ğŸ«§</td>
      <td>${u.sub_count}</td>
      <td>${u.comment_count}</td>
      <td style="color:var(--text3);font-size:12px">${fmtDateShort(u.created_at)}</td>
      <td>
        <button class="btn btn-sm btn-ghost" onclick="openUserModal(${u.id})">ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="11" class="empty">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹</td></tr>';

  renderPagination('users-pagination', usersPage, Math.ceil(d.total/30), p=>loadUsers(p));
}

// â”€â”€â”€ USER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentUserId = null;
async function openUserModal(uid){
  currentUserId = uid;
  $('user-modal').classList.add('open');
  $('um-subs-tbody').innerHTML = '<tr><td colspan="3" class="empty"><div class="spinner"></div></td></tr>';
  $('um-details').innerHTML = '<div style="grid-column:span 2;color:var(--text3)">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>';

  const d = await api(`/api/admin/users?page=1&per_page=1&q=${uid}`);
  const u = d.users.find(x=>x.id===uid) || d.users[0];
  if(!u){ toast('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½','error'); return; }

  $('um-title').textContent = userName(u);
  $('um-details').innerHTML = `
    <div><span style="color:var(--text3);font-size:11px">ID</span><br><b>${u.id}</b></div>
    <div><span style="color:var(--text3);font-size:11px">Telegram ID</span><br><b class="mono">${u.telegram_id}</b></div>
    <div><span style="color:var(--text3);font-size:11px">Username</span><br><b>@${esc(u.telegram_username||'â€”')}</b></div>
    <div><span style="color:var(--text3);font-size:11px">ĞœĞ¾Ğ½ĞµÑ‚Ñ‹</span><br><b>${fmtNum(u.coins)} ğŸ«§</b></div>
    <div><span style="color:var(--text3);font-size:11px">XP / Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</span><br><b>${fmtNum(u.xp)} / Ğ£Ñ€.${u.level}</b></div>
    <div><span style="color:var(--text3);font-size:11px">Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</span><br><b style="font-size:11px">${fmtDate(u.created_at)}</b></div>
    <div><span style="color:var(--text3);font-size:11px">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ñ…Ğ¾Ğ´</span><br><b style="font-size:11px">${fmtDate(u.last_login)}</b></div>
    <div><span style="color:var(--text3);font-size:11px">ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼</span><br><b>${u.is_premium ? 'âœ… Ğ´Ğ¾ '+fmtDateShort(u.premium_expires_at) : 'â€”'}</b></div>
  `;

  const banBtn = $('um-ban-btn');
  if(u.is_active){
    banBtn.textContent = 'ğŸ”¨ Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ';
    banBtn.className = 'btn btn-danger';
  } else {
    banBtn.textContent = 'âœ… Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ';
    banBtn.className = 'btn btn-success';
  }

  loadUserSubs(uid);
}

async function loadUserSubs(uid){
  const subs = await api(`/api/admin/users/${uid}/subscriptions`);
  $('um-subs-count').textContent = subs.length;
  $('um-subs-tbody').innerHTML = subs.length ? subs.map(s=>`
    <tr>
      <td style="padding:6px 14px">
        <a href="/manga/${esc(s.manga_slug)}" target="_blank" style="color:var(--primary);text-decoration:none">${esc(s.manga_title||s.manga_id)}</a>
      </td>
      <td style="padding:6px 14px;color:var(--text3);font-size:11px">${fmtDateShort(s.subscribed_at)}</td>
      <td style="padding:6px 14px">
        <button class="btn-icon" style="color:var(--red)" onclick="removeSub('${esc(s.manga_id)}')">ğŸ—‘</button>
      </td>
    </tr>
  `).join('') : '<tr><td colspan="3" class="empty">ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº</td></tr>';
}

async function toggleBan(){
  const r = await api(`/api/admin/users/${currentUserId}/ban`, {method:'POST'});
  if(r.success){
    const banned = r.is_active===0;
    toast(banned ? 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½' : 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½', banned?'error':'success');
    openUserModal(currentUserId);
    if(sectionLoaded['users']) loadUsers();
  }
}

async function setPremium(enabled){
  const days = parseInt($('um-premium-days').value)||30;
  const r = await api(`/api/admin/users/${currentUserId}/premium`, {method:'POST',body:JSON.stringify({enabled,days})});
  if(r.success){ toast(enabled ? `ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼ Ğ²Ñ‹Ğ´Ğ°Ğ½ Ğ½Ğ° ${days} Ğ´Ğ½ĞµĞ¹` : 'ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼ ÑĞ½ÑÑ‚'); openUserModal(currentUserId); }
}

async function setCoins(){
  const amount = parseInt($('um-coins-val').value);
  const mode = $('um-coins-mode').value;
  if(isNaN(amount)){ toast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾','error'); return; }
  const r = await api(`/api/admin/users/${currentUserId}/coins`, {method:'POST',body:JSON.stringify({amount,mode})});
  if(r.success){ toast('ĞœĞ¾Ğ½ĞµÑ‚Ñ‹ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹'); openUserModal(currentUserId); if(sectionLoaded['users'])loadUsers(); }
}

async function setXP(){
  const amount = parseInt($('um-xp-val').value);
  const mode = $('um-xp-mode').value;
  if(isNaN(amount)){ toast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‡Ğ¸ÑĞ»Ğ¾','error'); return; }
  const r = await api(`/api/admin/users/${currentUserId}/xp`, {method:'POST',body:JSON.stringify({amount,mode})});
  if(r.success){ toast('XP Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½'); openUserModal(currentUserId); if(sectionLoaded['users'])loadUsers(); }
}

async function addSub(){
  const manga_id = $('um-sub-manga-id').value.trim();
  if(!manga_id){ toast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ manga_id','error'); return; }
  const r = await api(`/api/admin/users/${currentUserId}/subscriptions`, {method:'POST',body:JSON.stringify({manga_id})});
  if(r.success){ toast('ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ°'); $('um-sub-manga-id').value=''; loadUserSubs(currentUserId); }
}

async function removeSub(manga_id){
  const r = await api(`/api/admin/users/${currentUserId}/subscriptions/${encodeURIComponent(manga_id)}`, {method:'DELETE'});
  if(r.success){ toast('ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°'); loadUserSubs(currentUserId); }
}

function closeUserModal(e){ if(e.target===e.currentTarget) e.currentTarget.classList.remove('open'); }

// â”€â”€â”€ COMMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let commentsPage = 1;
async function loadComments(page){
  if(page) commentsPage = page;
  const q = $('comments-search').value.trim();
  const d = await api(`/api/admin/comments?page=${commentsPage}&per_page=50&q=${encodeURIComponent(q)}`);
  $('comments-subtitle').textContent = `Ğ’ÑĞµĞ³Ğ¾: ${d.total}`;

  $('comments-tbody').innerHTML = d.comments.map(c=>`
    <tr>
      <td style="color:var(--text3)">${c.id}</td>
      <td>
        <div class="user-cell">
          <div class="user-ava">${c.avatar_url ? `<img src="${esc(c.avatar_url)}" onerror="this.style.display='none'">` : 'ğŸ‘¤'}</div>
          <div>
            <div style="cursor:pointer;color:var(--primary);font-size:13px" onclick="openUserModal(${c.user_id})">${esc(c.custom_name||c.telegram_first_name||c.telegram_username)}</div>
            <div class="user-username">@${esc(c.telegram_username||'â€”')}</div>
          </div>
        </div>
      </td>
      <td>
        <a href="/manga/${esc(c.manga_slug)}" target="_blank" style="color:var(--primary);text-decoration:none;font-size:12px">
          ${esc(c.manga_title||c.manga_slug)}
        </a>
      </td>
      <td><div class="comment-text">${esc(c.text)}</div></td>
      <td style="color:var(--text3);font-size:12px;white-space:nowrap">${fmtDate(c.created_at)}</td>
      <td>
        <button class="btn btn-sm btn-danger" onclick="deleteComment(${c.id}, this)">ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="6" class="empty">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹</td></tr>';

  renderPagination('comments-pagination', commentsPage, Math.ceil(d.total/50), p=>loadComments(p));
}

async function deleteComment(id, btn){
  if(!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹?')) return;
  btn.disabled = true;
  const r = await api(`/api/admin/comments/${id}`, {method:'DELETE'});
  if(r.success){ toast('ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½'); btn.closest('tr').remove(); }
  else { btn.disabled=false; toast('ĞÑˆĞ¸Ğ±ĞºĞ°','error'); }
}

// â”€â”€â”€ MANGA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mangaPage = 1;
async function loadManga(page){
  if(page) mangaPage = page;
  const q = $('manga-search').value.trim();
  const d = await api(`/api/admin/manga?page=${mangaPage}&per_page=30&q=${encodeURIComponent(q)}`);
  $('manga-subtitle').textContent = `Ğ’ÑĞµĞ³Ğ¾: ${d.total}`;

  $('manga-tbody').innerHTML = d.manga.map(m=>`
    <tr>
      <td>
        ${m.cover_url ? `<img src="${esc(m.cover_url)}" style="width:36px;height:50px;object-fit:cover;border-radius:4px" loading="lazy">` : '<div style="width:36px;height:50px;background:var(--bg4);border-radius:4px;display:flex;align-items:center;justify-content:center;color:var(--text3)">ğŸ“š</div>'}
      </td>
      <td>
        <a href="/manga/${esc(m.manga_slug)}" target="_blank" style="color:var(--primary);text-decoration:none;font-weight:500" class="truncate">${esc(m.manga_title)}</a>
        <div style="font-size:11px;color:var(--text3)">${esc(m.manga_slug)}</div>
      </td>
      <td><span class="badge badge-blue">${esc(m.manga_type||'â€”')}</span></td>
      <td><span class="badge badge-${m.manga_status==='ONGOING'?'green':m.manga_status==='FINISHED'?'blue':'yellow'}">${esc(m.manga_status||'â€”')}</span></td>
      <td>${m.chapters_count||0}</td>
      <td>${fmtNum(m.views)}</td>
      <td>${m.sub_count}</td>
      <td>${m.comment_count}</td>
    </tr>
  `).join('') || '<tr><td colspan="8" class="empty">ĞœĞ°Ğ½Ğ³Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°</td></tr>';

  renderPagination('manga-pagination', mangaPage, Math.ceil(d.total/30), p=>loadManga(p));
}

// â”€â”€â”€ SHOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TYPE_LABELS = {
  avatar:'ğŸ–¼ ĞĞ²Ğ°Ñ‚Ğ°Ñ€', frame:'ğŸ”² Ğ Ğ°Ğ¼ĞºĞ°', background:'ğŸŒ… Ğ¤Ğ¾Ğ½',
  badge:'ğŸ… Ğ—Ğ½Ğ°Ñ‡Ğ¾Ğº', avatar_slot:'ğŸ“¤ Ğ¡Ğ»Ğ¾Ñ‚ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°', bg_slot:'ğŸ“¤ Ğ¡Ğ»Ğ¾Ñ‚ Ñ„Ğ¾Ğ½Ğ°'
};

async function loadShop(){
  const items = await api('/api/admin/shop');
  $('shop-tbody').innerHTML = items.map(it=>`
    <tr>
      <td style="color:var(--text3)">${it.id}</td>
      <td>
        <div style="display:flex;align-items:center;gap:10px">
          ${it.preview_url
            ? `<img src="${esc(it.preview_url)}" style="width:36px;height:36px;border-radius:${it.type==='avatar'?'50%':'6px'};object-fit:cover;border:1px solid var(--border2)" loading="lazy">`
            : `<div style="width:36px;height:36px;border-radius:6px;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:16px">${TYPE_LABELS[it.type]?.charAt(0)||'?'}</div>`}
          <div>
            <div style="font-weight:600">${esc(it.name)}</div>
            <div style="font-size:11px;color:var(--text3)">${esc(it.description||'')}</div>
          </div>
        </div>
      </td>
      <td><span class="badge badge-blue">${TYPE_LABELS[it.type]||esc(it.type)}</span></td>
      <td><b>${fmtNum(it.price)}</b> ğŸ«§</td>
      <td><div class="truncate mono" style="max-width:160px;font-size:11px;color:var(--text3)">${esc(it.css_value||'â€”')}</div></td>
      <td>${it.purchases}</td>
      <td>
        ${it.is_upload ? '<span class="badge badge-yellow">upload</span>' : ''}
        ${it.is_animated ? '<span class="badge badge-purple">anim</span>' : ''}
      </td>
      <td>
        <div style="display:flex;gap:4px">
          <button class="btn btn-sm btn-ghost" onclick="openShopModal(${it.id})">âœï¸</button>
          <button class="btn btn-sm btn-danger" onclick="deleteShopItem(${it.id}, this)">ğŸ—‘</button>
        </div>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="8" class="empty">ĞĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²</td></tr>';
}

let _shopItems = [];
async function _ensureShopItems(){ if(!_shopItems.length) _shopItems = await api('/api/admin/shop'); }

// Ğ¢Ğ¸Ğ¿ â†’ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ ÑĞµĞºÑ†Ğ¸Ğ¹
const TYPE_CONFIG = {
  avatar:     { file:true,  css:false, fileLabel:'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°', hint:'' },
  frame:      { file:true,  css:true,  fileLabel:'ĞšĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ° Ñ€Ğ°Ğ¼ĞºĞ¸ (Ğ¾Ğ¿Ñ†.)', hint:'ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: border: 3px solid #FFD700; box-shadow: 0 0 12px #FFD700;' },
  background: { file:true,  css:true,  fileLabel:'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ğ½Ğ° (Ğ¾Ğ¿Ñ†.)', hint:'ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: background: linear-gradient(135deg, #0f0c29, #302b63);' },
  badge:      { file:true,  css:true,  fileLabel:'Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞºĞ° (Ğ¾Ğ¿Ñ†.)', hint:'ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: ğŸ‘‘ VIP â€” Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ CSS-Ñ‚ĞµĞºÑÑ‚' },
  avatar_slot:{ file:false, css:false, fileLabel:'', hint:'' },
  bg_slot:    { file:false, css:false, fileLabel:'', hint:'' },
};

function onShopTypeChange(){
  const type = $('sm-type').value;
  const cfg = TYPE_CONFIG[type] || { file:false, css:true, hint:'' };
  $('sm-file-section').style.display = cfg.file ? '' : 'none';
  $('sm-css-section').style.display  = cfg.css  ? '' : 'none';
  if(cfg.fileLabel) $('sm-file-label').textContent = cfg.fileLabel;
  if(cfg.hint !== undefined) $('sm-css-hint').textContent = cfg.hint;

  // ĞĞ²Ğ°Ñ‚Ğ°Ñ€ â€” ĞºÑ€ÑƒĞ³Ğ»Ğ¾Ğµ Ğ¿Ñ€ĞµĞ²ÑŒÑ
  const box = $('sm-preview-box');
  if(type === 'avatar'){
    box.style.width='96px'; box.style.height='96px'; box.style.borderRadius='50%';
    $('sm-preview-img').style.borderRadius='50%';
  } else {
    box.style.width=''; box.style.height='120px'; box.style.borderRadius='10px';
    $('sm-preview-img').style.borderRadius='';
  }
}

function _setPreviewImg(url){
  if(url){
    $('sm-preview-img').src = url;
    $('sm-preview-wrap').style.display = '';
    $('sm-drop-zone').style.display = 'none';
  } else {
    $('sm-preview-wrap').style.display = 'none';
    $('sm-drop-zone').style.display = '';
  }
}

function clearShopImage(){
  $('sm-preview-url').value = '';
  $('sm-file-input').value = '';
  _setPreviewImg(null);
}

function onPreviewUrlInput(){
  const url = $('sm-preview-url').value.trim();
  _setPreviewImg(url || null);
}

async function onShopFileSelect(input){
  const file = input.files[0];
  if(!file) return;
  if(file.size > 5*1024*1024){ toast('Ğ¤Ğ°Ğ¹Ğ» ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ (Ğ¼Ğ°ĞºÑ. 5 ĞœĞ‘)','error'); return; }

  // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ
  const prog = $('sm-progress');
  const bar  = $('sm-progress-bar');
  prog.style.display='block'; bar.style.width='20%';

  const fd = new FormData();
  fd.append('file', file);
  try {
    bar.style.width = '60%';
    const r = await fetch('/api/admin/shop/upload', {method:'POST', body:fd});
    bar.style.width = '100%';
    const data = await r.json();
    if(data.url){
      $('sm-preview-url').value = data.url;
      _setPreviewImg(data.url);
      toast('Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½');
    } else {
      toast(data.error||'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸','error');
    }
  } catch(e){
    toast('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸','error');
  } finally {
    setTimeout(()=>{ prog.style.display='none'; bar.style.width='0%'; }, 600);
  }
}

// Drag & Drop Ğ½Ğ° Ğ·Ğ¾Ğ½Ñƒ
document.addEventListener('DOMContentLoaded', ()=>{
  const dz = $('sm-drop-zone');
  if(!dz) return;
  dz.addEventListener('dragover', e=>{ e.preventDefault(); dz.classList.add('over'); });
  dz.addEventListener('dragleave', ()=>dz.classList.remove('over'));
  dz.addEventListener('drop', e=>{
    e.preventDefault(); dz.classList.remove('over');
    const file = e.dataTransfer.files[0];
    if(file){
      const dt = new DataTransfer();
      dt.items.add(file);
      $('sm-file-input').files = dt.files;
      onShopFileSelect($('sm-file-input'));
    }
  });
});

async function openShopModal(id){
  $('sm-id').value = id||'';
  clearShopImage();
  if(id){
    await _ensureShopItems();
    const it = _shopItems.find(x=>x.id===id);
    if(it){
      $('sm-title').textContent = 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€';
      $('sm-name').value = it.name||'';
      $('sm-description').value = it.description||'';
      $('sm-type').value = it.type||'frame';
      $('sm-price').value = it.price||0;
      $('sm-css').value = it.css_value||'';
      $('sm-upload').checked = !!it.is_upload;
      $('sm-animated').checked = !!it.is_animated;
      if(it.preview_url){
        $('sm-preview-url').value = it.preview_url;
        _setPreviewImg(it.preview_url);
      }
    }
  } else {
    $('sm-title').textContent = 'ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€';
    ['sm-name','sm-description','sm-css','sm-preview-url'].forEach(id=>$(id).value='');
    $('sm-type').value='avatar'; $('sm-price').value=0;
    $('sm-upload').checked=false; $('sm-animated').checked=false;
  }
  onShopTypeChange();
  $('shop-modal').classList.add('open');
}

async function saveShopItem(){
  const id = $('sm-id').value;
  const body = {
    name: $('sm-name').value.trim(),
    description: $('sm-description').value.trim(),
    type: $('sm-type').value,
    price: parseInt($('sm-price').value)||0,
    css_value: $('sm-css').value.trim(),
    preview_url: $('sm-preview-url').value.trim(),
    is_upload: $('sm-upload').checked,
    is_animated: $('sm-animated').checked,
  };
  if(!body.name){ toast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ','error'); return; }
  const url = id ? `/api/admin/shop/${id}` : '/api/admin/shop';
  const method = id ? 'PUT' : 'POST';
  const btn = $('sm-save-btn');
  btn.disabled = true; btn.textContent = 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ...';
  try {
    const r = await api(url, {method, body:JSON.stringify(body)});
    if(r.success||r.id){
      toast(id ? 'Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½' : 'Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½');
      $('shop-modal').classList.remove('open');
      _shopItems = [];
      loadShop();
    } else { toast(r.error||'ĞÑˆĞ¸Ğ±ĞºĞ°','error'); }
  } finally {
    btn.disabled=false; btn.textContent='Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ';
  }
}

async function deleteShopItem(id, btn){
  if(!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€? Ğ­Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¶Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ ĞµĞ³Ğ¾ Ñƒ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹!')) return;
  btn.disabled=true;
  const r = await api(`/api/admin/shop/${id}`, {method:'DELETE'});
  if(r.success){ toast('Ğ¢Ğ¾Ğ²Ğ°Ñ€ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½'); _shopItems=[]; loadShop(); }
  else { btn.disabled=false; toast('ĞÑˆĞ¸Ğ±ĞºĞ°','error'); }
}

function closeShopModal(e){ if(e.target===e.currentTarget) e.currentTarget.classList.remove('open'); }

// â”€â”€â”€ XP LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let xplogPage = 1;
async function loadXpLog(page){
  if(page) xplogPage = page;
  const d = await api(`/api/admin/xp_log?page=${xplogPage}&per_page=50`);
  $('xplog-subtitle').textContent = `Ğ’ÑĞµĞ³Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹: ${d.total}`;

  $('xplog-tbody').innerHTML = d.logs.map(l=>`
    <tr>
      <td style="color:var(--text3)">${l.id}</td>
      <td>
        <span style="cursor:pointer;color:var(--primary)" onclick="openUserModal(${l.user_id})">
          ${esc(l.custom_name||l.telegram_first_name||l.telegram_username||`#${l.user_id}`)}
        </span>
        <div class="user-username">@${esc(l.telegram_username||'â€”')}</div>
      </td>
      <td><span class="badge badge-blue">${esc(l.reason)}</span></td>
      <td class="mono" style="color:var(--text3);font-size:11px">${esc(l.ref_id||'â€”')}</td>
      <td class="${l.amount>=0?'text-green':'text-red'}"><b>${l.amount>=0?'+':''}${l.amount}</b></td>
      <td style="color:var(--text3);font-size:12px">${fmtDate(l.created_at)}</td>
    </tr>
  `).join('') || '<tr><td colspan="6" class="empty">ĞĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹</td></tr>';

  renderPagination('xplog-pagination', xplogPage, Math.ceil(d.total/50), p=>loadXpLog(p));
}

// â”€â”€â”€ PAGINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPagination(elId, page, totalPages, onPage){
  const el = $(elId);
  if(totalPages<=1){ el.innerHTML=''; return; }
  let html = '';
  html += `<button class="btn btn-ghost btn-sm" ${page<=1?'disabled':''} onclick="(${onPage})(${page-1})">â€¹</button>`;
  const start = Math.max(1, page-2), end = Math.min(totalPages, page+2);
  if(start>1) html += `<button class="btn btn-ghost btn-sm" onclick="(${onPage})(1)">1</button>${start>2?'<span class="page-info">â€¦</span>':''}`;
  for(let p=start;p<=end;p++)
    html += `<button class="btn btn-sm ${p===page?'btn-primary':'btn-ghost'}" onclick="(${onPage})(${p})">${p}</button>`;
  if(end<totalPages) html += `${end<totalPages-1?'<span class="page-info">â€¦</span>':''}<button class="btn btn-ghost btn-sm" onclick="(${onPage})(${totalPages})">${totalPages}</button>`;
  html += `<button class="btn btn-ghost btn-sm" ${page>=totalPages?'disabled':''} onclick="(${onPage})(${page+1})">â€º</button>`;
  html += `<span class="page-info">${page} / ${totalPages}</span>`;
  el.innerHTML = html;
}

// â”€â”€â”€ SHARED ICON UPLOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONDITION_LABELS = {
  chapters_read:'ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¾ Ğ³Ğ»Ğ°Ğ²', subscriptions:'ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸',
  level:'Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ', comments_posted:'ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸'
};

function _setIconPreview(prefix, url){
  if(url){
    $(`${prefix}-preview-img`).src = url;
    $(`${prefix}-preview-wrap`).style.display='';
    $(`${prefix}-drop-zone`).style.display='none';
  } else {
    $(`${prefix}-preview-wrap`).style.display='none';
    $(`${prefix}-drop-zone`).style.display='';
  }
}

function clearIconPreview(prefix){
  $(`${prefix}-icon-url`).value='';
  _setIconPreview(prefix, null);
}

function achPreviewUrl(){ _setIconPreview('ach', $('ach-icon-url').value.trim()||null); }
function questPreviewUrl(){ _setIconPreview('quest', $('quest-icon-url').value.trim()||null); }

async function uploadIconFile(prefix, input){
  const file = input.files[0];
  if(!file) return;
  if(file.size > 5*1024*1024){ toast('Ğ¤Ğ°Ğ¹Ğ» ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹','error'); return; }
  const prog = $(`${prefix}-progress`), bar = $(`${prefix}-progress-bar`);
  prog.style.display='block'; bar.style.width='20%';
  const fd = new FormData();
  fd.append('file', file);
  const endpoint = prefix==='ach' ? '/api/admin/achievements/upload' : '/api/admin/quests/upload';
  try {
    bar.style.width='60%';
    const r = await fetch(endpoint, {method:'POST', body:fd});
    bar.style.width='100%';
    const data = await r.json();
    if(data.url){
      $(`${prefix}-icon-url`).value = data.url;
      _setIconPreview(prefix, data.url);
      toast('Ğ¤Ğ°Ğ¹Ğ» Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½');
    } else { toast(data.error||'ĞÑˆĞ¸Ğ±ĞºĞ°','error'); }
  } catch(e){ toast('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸','error'); }
  finally { setTimeout(()=>{ prog.style.display='none'; bar.style.width='0%'; },600); }
}

// â”€â”€â”€ ACHIEVEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _achList = [];

async function loadAchievements(){
  const d = await api('/api/admin/achievements');
  _achList = d.achievements || [];
  $('ach-tbody').innerHTML = _achList.map(a=>`
    <tr>
      <td style="color:var(--text3)">${a.id}</td>
      <td style="font-size:22px;text-align:center">
        ${a.icon_url ? `<img src="${esc(a.icon_url)}" style="width:32px;height:32px;object-fit:cover;border-radius:6px;vertical-align:middle">` : esc(a.icon||'ğŸ†')}
      </td>
      <td><span class="mono" style="font-size:12px;color:var(--text3)">${esc(a.key)}</span></td>
      <td><b>${esc(a.name)}</b><br><span style="font-size:11px;color:var(--text3)">${esc(a.description||'')}</span></td>
      <td><span class="badge badge-blue">${esc(CONDITION_LABELS[a.condition_type]||a.condition_type)}</span></td>
      <td><b>${a.condition_value}</b></td>
      <td>${a.xp_reward > 0 ? `<span class="badge badge-purple">+${a.xp_reward} XP</span>` : 'â€”'}</td>
      <td>
        <div style="display:flex;gap:4px">
          <button class="btn btn-sm btn-ghost" onclick="openAchModal(${a.id})">âœï¸</button>
          <button class="btn btn-sm btn-danger" onclick="deleteAchievement(${a.id},this)">ğŸ—‘</button>
        </div>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="8" class="empty">ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹</td></tr>';
}

function openAchModal(id){
  $('ach-id').value = id||'';
  clearIconPreview('ach');
  if(id){
    const a = _achList.find(x=>x.id===id);
    if(a){
      $('ach-modal-title').textContent = 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ';
      $('ach-key').value = a.key||'';
      $('ach-name').value = a.name||'';
      $('ach-description').value = a.description||'';
      $('ach-icon').value = a.icon||'ğŸ†';
      $('ach-icon-url').value = a.icon_url||'';
      $('ach-condition-type').value = a.condition_type||'chapters_read';
      $('ach-condition-value').value = a.condition_value||1;
      $('ach-xp-reward').value = a.xp_reward||0;
      if(a.icon_url) _setIconPreview('ach', a.icon_url);
    }
  } else {
    $('ach-modal-title').textContent = 'ĞĞ¾Ğ²Ğ¾Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ';
    ['ach-key','ach-name','ach-description','ach-icon-url'].forEach(i=>$(i).value='');
    $('ach-icon').value='ğŸ†';
    $('ach-condition-type').value='chapters_read';
    $('ach-condition-value').value=1;
    $('ach-xp-reward').value=0;
  }
  $('ach-modal').classList.add('open');
}

async function saveAchievement(){
  const id = $('ach-id').value;
  const body = {
    key: $('ach-key').value.trim(),
    name: $('ach-name').value.trim(),
    description: $('ach-description').value.trim(),
    icon: $('ach-icon').value.trim()||'ğŸ†',
    icon_url: $('ach-icon-url').value.trim()||null,
    xp_reward: parseInt($('ach-xp-reward').value)||0,
    condition_type: $('ach-condition-type').value,
    condition_value: parseInt($('ach-condition-value').value)||1,
  };
  if(!body.key||!body.name){ toast('Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ ĞºĞ»ÑÑ‡ Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ','error'); return; }
  const url = id ? `/api/admin/achievements/${id}` : '/api/admin/achievements';
  const method = id ? 'PUT' : 'POST';
  const btn = $('ach-save-btn');
  btn.disabled=true; btn.textContent='Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ...';
  try {
    const r = await api(url, {method, body:JSON.stringify(body)});
    if(r.success||r.id){ toast(id?'ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾':'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾'); $('ach-modal').classList.remove('open'); loadAchievements(); }
    else toast(r.error||'ĞÑˆĞ¸Ğ±ĞºĞ°','error');
  } finally { btn.disabled=false; btn.textContent='Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ'; }
}

async function deleteAchievement(id, btn){
  if(!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ?')) return;
  btn.disabled=true;
  const r = await api(`/api/admin/achievements/${id}`, {method:'DELETE'});
  if(r.success){ toast('Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾'); loadAchievements(); }
  else { btn.disabled=false; toast('ĞÑˆĞ¸Ğ±ĞºĞ°','error'); }
}

// â”€â”€â”€ QUESTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _questList = [];

async function loadQuests(){
  const d = await api('/api/admin/quests');
  _questList = d.quests || [];
  $('quests-tbody').innerHTML = _questList.map(q=>`
    <tr>
      <td style="color:var(--text3)">${q.id}</td>
      <td style="font-size:22px;text-align:center">
        ${q.icon_url ? `<img src="${esc(q.icon_url)}" style="width:32px;height:32px;object-fit:cover;border-radius:6px;vertical-align:middle">` : esc(q.icon||'ğŸ“‹')}
      </td>
      <td><b>${esc(q.title)}</b><br><span style="font-size:11px;color:var(--text3)">${esc(q.description||'')}</span></td>
      <td><span class="badge badge-purple">Ğ£Ñ€. ${q.required_level}+</span></td>
      <td><span class="badge badge-blue">${esc(CONDITION_LABELS[q.condition_type]||q.condition_type)}</span></td>
      <td><b>${q.condition_value}</b></td>
      <td>${q.xp_reward > 0 ? `<span style="color:var(--green)">+${q.xp_reward}</span>` : 'â€”'}</td>
      <td>${q.coins_reward > 0 ? `<span style="color:var(--yellow)">+${q.coins_reward}</span>` : 'â€”'}</td>
      <td>${q.is_active ? '<span class="badge badge-green">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾</span>' : '<span class="badge badge-red">Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ¾</span>'}</td>
      <td>
        <div style="display:flex;gap:4px">
          <button class="btn btn-sm btn-ghost" onclick="openQuestModal(${q.id})">âœï¸</button>
          <button class="btn btn-sm btn-danger" onclick="deleteQuest(${q.id},this)">ğŸ—‘</button>
        </div>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="10" class="empty">ĞĞµÑ‚ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹</td></tr>';
}

function openQuestModal(id){
  $('quest-id').value = id||'';
  clearIconPreview('quest');
  if(id){
    const q = _questList.find(x=>x.id===id);
    if(q){
      $('quest-modal-title').textContent = 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ';
      $('quest-title').value = q.title||'';
      $('quest-description').value = q.description||'';
      $('quest-icon').value = q.icon||'ğŸ“‹';
      $('quest-icon-url').value = q.icon_url||'';
      $('quest-required-level').value = q.required_level||1;
      $('quest-condition-type').value = q.condition_type||'chapters_read';
      $('quest-condition-value').value = q.condition_value||1;
      $('quest-xp-reward').value = q.xp_reward||0;
      $('quest-coins-reward').value = q.coins_reward||0;
      $('quest-is-active').checked = !!q.is_active;
      if(q.icon_url) _setIconPreview('quest', q.icon_url);
    }
  } else {
    $('quest-modal-title').textContent = 'ĞĞ¾Ğ²Ğ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ';
    ['quest-title','quest-description','quest-icon-url'].forEach(i=>$(i).value='');
    $('quest-icon').value='ğŸ“‹';
    $('quest-required-level').value=1;
    $('quest-condition-type').value='chapters_read';
    $('quest-condition-value').value=1;
    $('quest-xp-reward').value=0;
    $('quest-coins-reward').value=0;
    $('quest-is-active').checked=true;
  }
  $('quest-modal').classList.add('open');
}

async function saveQuest(){
  const id = $('quest-id').value;
  const body = {
    title: $('quest-title').value.trim(),
    description: $('quest-description').value.trim(),
    icon: $('quest-icon').value.trim()||'ğŸ“‹',
    icon_url: $('quest-icon-url').value.trim()||null,
    required_level: parseInt($('quest-required-level').value)||1,
    condition_type: $('quest-condition-type').value,
    condition_value: parseInt($('quest-condition-value').value)||1,
    xp_reward: parseInt($('quest-xp-reward').value)||0,
    coins_reward: parseInt($('quest-coins-reward').value)||0,
    is_active: $('quest-is-active').checked ? 1 : 0,
  };
  if(!body.title){ toast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ','error'); return; }
  const url = id ? `/api/admin/quests/${id}` : '/api/admin/quests';
  const method = id ? 'PUT' : 'POST';
  const btn = $('quest-save-btn');
  btn.disabled=true; btn.textContent='Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ...';
  try {
    const r = await api(url, {method, body:JSON.stringify(body)});
    if(r.success||r.id){ toast(id?'ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾':'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾'); $('quest-modal').classList.remove('open'); loadQuests(); }
    else toast(r.error||'ĞÑˆĞ¸Ğ±ĞºĞ°','error');
  } finally { btn.disabled=false; btn.textContent='Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ'; }
}

async function deleteQuest(id, btn){
  if(!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ? ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ±ÑƒĞ´ĞµÑ‚ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½.')) return;
  btn.disabled=true;
  const r = await api(`/api/admin/quests/${id}`, {method:'DELETE'});
  if(r.success){ toast('Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾'); loadQuests(); }
  else { btn.disabled=false; toast('ĞÑˆĞ¸Ğ±ĞºĞ°','error'); }
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadStats();
</script>
</body>
</html>
