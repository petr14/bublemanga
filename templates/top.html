<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0"/>
  <meta name="theme-color" content="#667eea"/>
  <title>Ğ¢Ğ¾Ğ¿ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ĞµĞ»ĞµĞ¹ â€” BubbleManga</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    :root {
      --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --accent: #667eea;
      --bg: #0a0a0a;
      --card: #1a1a1a;
      --card2: #141414;
      --border: rgba(255,255,255,.06);
      --text: #ffffff;
      --text-2: #b8b8b8;
      --text-3: #71717a;
    }
    html, body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg); color: var(--text);
      -webkit-font-smoothing: antialiased; line-height: 1.6;
    }
    a { color: inherit; }

    /* â”€â”€ Ğ¨Ğ°Ğ¿ĞºĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .site-header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
      background: rgba(10,10,10,.97);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .site-header-inner {
      max-width: 1400px; margin: 0 auto; padding: 14px 20px;
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
    }
    .site-logo {
      font-size: 20px; font-weight: 800; text-decoration: none; letter-spacing: -.5px;
      background: var(--primary);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      display: flex; align-items: center; gap: 7px;
    }
    .site-nav { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .nav-btn {
      padding: 8px 16px; background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1); border-radius: 50px;
      color: #fff; text-decoration: none; font-size: 13px; font-weight: 600;
      cursor: pointer; font-family: inherit; white-space: nowrap;
      transition: background .2s, transform .15s;
      display: inline-flex; align-items: center; gap: 5px;
    }
    .nav-btn:active { transform: scale(.95); }
    .nav-btn.active { background: var(--primary); border-color: transparent; }
    @media(min-width:1024px) {
      .nav-btn:hover { background: rgba(255,255,255,.09); }
      .nav-btn.active:hover { opacity: .88; }
    }

    /* â”€â”€ Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page-wrap { padding-top: 72px; }

    /* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .top-hero {
      text-align: center; padding: 4rem 1rem 2.5rem;
      background: linear-gradient(135deg, #08081a 0%, #0f0c2a 50%, #10091e 100%);
      border-bottom: 1px solid var(--border);
    }
    .top-hero h1 {
      font-size: 2.5rem; font-weight: 800;
      background: var(--primary);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: .5rem;
    }
    .top-hero p { color: var(--text-2); font-size: .95rem; }

    /* â”€â”€ ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .top-container { max-width: 860px; margin: 0 auto; padding: 1.5rem; }

    /* â”€â”€ ĞŸÑŒĞµĞ´ĞµÑÑ‚Ğ°Ğ» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .podium {
      display: flex; justify-content: center; align-items: flex-end;
      gap: 1rem; margin-bottom: 2.5rem;
    }
    .podium-item { text-align: center; flex: 1; max-width: 180px; text-decoration: none; }
    .podium-avatar {
      width: 72px; height: 72px; border-radius: 50%;
      margin: 0 auto .5rem;
      background: var(--primary);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.8rem; overflow: hidden;
      box-shadow: 0 4px 24px rgba(102,126,234,.35);
    }
    .podium-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .podium-name {
      font-size: .85rem; font-weight: 600; color: #d4d4d8;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .podium-xp { font-size: .75rem; color: var(--text-3); margin-top: .15rem; }
    .podium-stand {
      border-radius: 8px 8px 0 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; font-weight: 800; color: #fff; margin-top: .5rem;
    }
    .stand-1 { height: 90px; background: linear-gradient(135deg, #FFD700, #FFA500); }
    .stand-2 { height: 70px; background: linear-gradient(135deg, #C0C0C0, #909090); }
    .stand-3 { height: 55px; background: linear-gradient(135deg, #CD7F32, #8B4513); }

    /* â”€â”€ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .leaderboard {
      background: var(--card2); border-radius: 16px;
      border: 1px solid var(--border); overflow: hidden;
    }
    .lb-row {
      display: flex; align-items: center; gap: 1rem;
      padding: .85rem 1.25rem;
      border-bottom: 1px solid rgba(255,255,255,.04);
      transition: background .15s; text-decoration: none; color: inherit;
    }
    .lb-row:last-child { border-bottom: none; }
    .lb-row:hover { background: var(--card); }
    .lb-row.me { background: rgba(102,126,234,.08); }

    .lb-rank {
      width: 36px; text-align: center; font-weight: 700; font-size: 1rem;
      color: var(--text-3); flex-shrink: 0;
    }
    .lb-rank.top3 { color: #FFD700; }

    .lb-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--primary);
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; flex-shrink: 0; overflow: hidden;
    }
    .lb-avatar img { width: 100%; height: 100%; object-fit: cover; }

    .lb-name {
      flex: 1; font-weight: 600; font-size: .9rem; color: #d4d4d8;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .lb-level {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 20px; padding: .2rem .6rem;
      font-size: .75rem; font-weight: 700; color: var(--accent); flex-shrink: 0;
    }
    .lb-xp { text-align: right; flex-shrink: 0; }
    .lb-xp-val { font-weight: 700; font-size: .9rem; color: #fff; }
    .lb-xp-label { font-size: .7rem; color: var(--text-3); }

    .lb-chapters { text-align: right; flex-shrink: 0; display: none; }
    @media(min-width:500px) { .lb-chapters { display: block; } }
    .lb-chapters-val { font-weight: 600; font-size: .85rem; color: var(--text-2); }
    .lb-chapters-label { font-size: .7rem; color: var(--text-3); }

    .lb-premium-crown {
      display: inline-flex; align-items: center; justify-content: center;
      width: 18px; height: 18px; border-radius: 50%; flex-shrink: 0;
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      font-size: 10px; line-height: 1; margin-left: .35rem;
      box-shadow: 0 0 6px rgba(251,191,36,.5);
      vertical-align: middle;
    }
  </style>
</head>
<body>

{% set g_active = 'top' %}{% include 'header.html' %}

<div class="page-wrap">
  <div id="top-root"></div>
</div>

<script type="importmap">
{"imports":{"react":"https://esm.sh/react@18","react-dom/client":"https://esm.sh/react-dom@18/client"}}
</script>
<script type="module">
import React from 'react';
import {createRoot} from 'react-dom/client';
const {createElement:h,Fragment} = React;

const LEADERS = {{ leaders | tojson }};
const MY_ID   = {{ user_id | tojson }};

function Av({url, size=40, fontSize='1rem'}){
  const s = {
    width:size, height:size, borderRadius:'50%',
    background:'linear-gradient(135deg,#667eea,#764ba2)',
    display:'flex', alignItems:'center', justifyContent:'center',
    fontSize, flexShrink:0, overflow:'hidden'
  };
  return h('div',{style:s},
    url ? h('img',{src:url,style:{width:'100%',height:'100%',objectFit:'cover'},alt:''}) : ''
  );
}

function Podium(){
  const top3 = LEADERS.slice(0,3);
  if(top3.length < 1) return null;
  const order  = top3.length >= 3 ? [top3[1],top3[0],top3[2]] : [top3[0]];
  const stands = top3.length >= 3 ? ['stand-2','stand-1','stand-3'] : ['stand-1'];
  const medals = top3.length >= 3 ? ['2','1','3'] : ['1'];

  return h('div',{className:'podium'},
    order.map((u,i)=>
      h('a',{key:u.id, className:'podium-item', href:`/profile/${u.id}`},
        h('div',{className:'podium-avatar'}, h(Av,{url:u.avatar_url,size:72,fontSize:'1.8rem'})),
        h('div',{className:'podium-name'}, u.custom_name||u.telegram_first_name||u.telegram_username||`#${u.id}`),
        h('div',{className:'podium-xp'}, `${(u.xp||0).toLocaleString()} XP`),
        h('div',{className:`podium-stand ${stands[i]}`}, medals[i])
      )
    )
  );
}

function LbRow({u, rank}){
  const name = u.custom_name||u.telegram_first_name||u.telegram_username||`ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ #${u.id}`;
  const isMe = u.id === MY_ID;
  return h('a',{className:`lb-row${isMe?' me':''}`, href:`/profile/${u.id}`},
    h('div',{className:`lb-rank${rank<=3?' top3':''}`},
      rank
    ),
    h('div',{className:'lb-avatar'}, h(Av,{url:u.avatar_url,size:40})),
    h('div',{className:'lb-name'},
      name,
      u.is_premium && h('span',{className:'lb-premium-crown',title:'Premium'},'ğŸ‘‘'),
      isMe && h('span',{style:{marginLeft:'.4rem',color:'#667eea',fontSize:'.75rem'}},'(Ğ²Ñ‹)')
    ),
    h('div',{className:'lb-level'}, `Lv.${u.level||1}`),
    h('div',{className:'lb-chapters'},
      h('div',{className:'lb-chapters-val'}, u.total_chapters_read||0),
      h('div',{className:'lb-chapters-label'}, 'Ğ³Ğ»Ğ°Ğ²')
    ),
    h('div',{className:'lb-xp'},
      h('div',{className:'lb-xp-val'}, (u.xp||0).toLocaleString()),
      h('div',{className:'lb-xp-label'}, 'XP')
    )
  );
}

function TopPage(){
  return h(Fragment,null,
    h('div',{className:'top-hero'},
      h('h1',null,'Ğ¢Ğ¾Ğ¿ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ĞµĞ»ĞµĞ¹'),
      h('p',null,'Ğ§Ğ¸Ñ‚Ğ°Ğ¹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ â€” Ğ·Ğ°Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹ XP â€” Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ¸ Ğ² Ñ‚Ğ¾Ğ¿')
    ),
    h('div',{className:'top-container'},
      h(Podium),
      LEADERS.length === 0
        ? h('p',{style:{textAlign:'center',color:'#71717a',padding:'2rem'}},
            'ĞŸĞ¾ĞºĞ° Ğ½Ğ¸ĞºĞ¾Ğ³Ğ¾ Ğ½ĞµÑ‚. Ğ‘ÑƒĞ´ÑŒ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼!')
        : h('div',{className:'leaderboard'},
            LEADERS.map((u,i)=>h(LbRow,{key:u.id,u,rank:i+1}))
          )
    )
  );
}

createRoot(document.getElementById('top-root')).render(h(TopPage));
</script>
</body>
</html>
